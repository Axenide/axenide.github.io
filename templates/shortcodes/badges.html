{% import "macros/icon.html" as macros_icon %}

<aside id="badges">
	<div style="display: flex; align-items: baseline; gap: 0.5rem; margin-bottom: 1rem;">
		<strong class="title">Badges</strong>
		<small><abbr title="Also Known As">AKA</abbr> 88x31 buttons</small>
	</div>
	<input type="checkbox" id="badges-popup-expand" class="visually-hidden" autocomplete="off" />
	<label for="badges-popup-expand" id="badges-plus-label" autocomplete="off" title="Link to Me">
		{{- macros_icon::icon(name="plus") -}}
		{{- macros_icon::icon(name="x") -}}
	</label>
	
	<!-- Wide Desktop: Arrow on the right -->
	<div class="desktop-only badge-arrow-wide" style="position: absolute; top: -3.5rem; right: -2rem; z-index: 20;">
		{% set text = note_text | default(value="My 88x31 here") %}
		{% set target = "badges-plus-label" %}
		{% set start_dir = "right" %}
		{% set end_dir = "right" %}
		{% set color = "accent" %}
		{% set font_size = "1.6rem" %}
		{% set amplitude = "50" %}
		{% set spacing = "10" %}
		{% include "shortcodes/arrow_note.html" %}
	</div>

	<!-- Narrow Desktop: Arrow from bottom (prevents clipping) -->
	<div class="desktop-only badge-arrow-narrow" style="position: absolute; top: -3.5rem; right: 1.5rem; z-index: 20;">
		{% set text = note_text | default(value="My 88x31 here") %}
		{% set target = "badges-plus-label" %}
		{% set start_dir = "bottom" %}
		{% set end_dir = "left" %}
		{% set color = "accent" %}
		{% set font_size = "1.6rem" %}
		{% set amplitude = "30" %}
		{% set spacing = "10" %}
		{% include "shortcodes/arrow_note.html" %}
	</div>

	<div id="badges-popup">
		<p>
			If you'd like to link to me, you can use one of the following badges:
		</p>
		<ul>
			<li>
				<img width="88" height="31" class="pixels transparent no-hover" alt="Axenide" src="{{ get_url(path='images/88x31.gif') }}" />
				<span>Current</span>
			</li>
		</ul>
	</div>
	
	<div class="badges-marquee-wrapper overshoot-row">
		<div class="badges-marquee">
			<ul style="--duration: {{ section.extra.badges | length * 2 | default(value=10) }}s">
				{%- for badge in section.extra.badges -%}
					<li>
						{%- if badge.url -%}
							<a href="{{ badge.url }}">
						{%- endif -%}
							
							{%- set img_src = "" -%}
							{%- if badge.image -%}
								{%- if badge.image is starting_with("http") -%}
									{%- set img_src = badge.image -%}
								{%- else -%}
									{%- set img_src = get_url(path=badge.image) -%}
								{%- endif -%}
							{%- else -%}
								{# Fallback for legacy/simple names, assumes badges/badges/ prefix unless http #}
								{%- if badge.name is starting_with("http") -%}
									{%- set img_src = badge.name -%}
								{%- else -%}
									{%- set img_src = get_url(path="badges/" ~ badge.name) -%}
								{%- endif -%}
							{%- endif -%}

							<img
								width="88"
								height="31"
								class="pixels transparent no-hover"
								{%- if badge.alt -%}
									alt="{{ badge.alt }}"
								{%- else -%}
									alt="{{ badge.name }}"
								{%- endif -%}
								src="{{ img_src }}"
								{% if config.markdown.lazy_async_image %}
									decoding="async" loading="lazy"
								{% endif %}
							/>
						{%- if badge.url -%}
							</a>
						{%- endif -%}
					</li>
				{%- endfor -%}
				<li>
					<iframe src="https://incr.easrng.net/badge?key={{ config.base_url | replace(from='https://', to='') }}" title="increment badge"></iframe>
				</li>
			</ul>
			<ul style="--duration: {{ section.extra.badges | length * 2 | default(value=10) }}s" aria-hidden="true">
				{%- for badge in section.extra.badges -%}
					<li>
						{%- if badge.url -%}
							<a href="{{ badge.url }}">
						{%- endif -%}
							
							{%- set img_src = "" -%}
							{%- if badge.image -%}
								{%- if badge.image is starting_with("http") -%}
									{%- set img_src = badge.image -%}
								{%- else -%}
									{%- set img_src = get_url(path=badge.image) -%}
								{%- endif -%}
							{%- else -%}
								{%- if badge.name is starting_with("http") -%}
									{%- set img_src = badge.name -%}
								{%- else -%}
									{%- set img_src = get_url(path="badges/" ~ badge.name) -%}
								{%- endif -%}
							{%- endif -%}

							<img
								width="88"
								height="31"
								class="pixels transparent no-hover"
								{%- if badge.alt -%}
									alt="{{ badge.alt }}"
								{%- else -%}
									alt="{{ badge.name }}"
								{%- endif -%}
								src="{{ img_src }}"
							/>
						{%- if badge.url -%}
							</a>
						{%- endif -%}
					</li>
				{%- endfor -%}
				<li>
					<iframe src="https://incr.easrng.net/badge?key={{ config.base_url | replace(from='https://', to='') }}" title="increment badge"></iframe>
				</li>
			</ul>
		</div>
	</div>
</aside>
