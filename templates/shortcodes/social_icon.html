{% set icon_size = size | default(value="16px") %}
{% set icon_url = link | default(value=url | default(value="#")) %}
{% set effect_list = effect | default(value="") %}

{# --- 1. Handle Icon Filename (.png automatico) --- #}
{% set icon_filename = icon %}
{% if not icon is ending_with(".png") %}
    {% set icon_filename = icon ~ ".png" %}
{% endif %}

{# --- 2. Determine Folder based on requested size --- #}
{% set num_size = icon_size | replace(from="px", to="") | int %}
{% if num_size <= 16 %}
    {% set folder = "16x" %}
{% elif num_size <= 128 %}
    {% set folder = "128x" %}
{% else %}
    {% set folder = "512x" %}
{% endif %}

{# --- 3. Parse Parameters for Effects --- #}

{# Defaults #}
{% set d_z_val = 1.2 %}
{% set d_z_dur = "0.25s" %}
{% set d_r_val = 30 %}
{% set d_r_dur = "0.5s" %}

{# --- Zoom Logic --- #}
{% set final_z_val = 1.0 %}
{% set final_z_dur = d_z_dur %}

{% if zoom %}
    {# User provided explicit zoom param #}
    {% set z_str = zoom | as_str %}
    {% if "," in z_str %}
        {% set parts = z_str | split(pat=",") %}
        {% set final_z_val = parts[0] | trim %}
        {% set final_z_dur = parts[1] | trim %}
    {% else %}
        {% set final_z_val = z_str | trim %}
    {% endif %}
{% elif "zoom" in effect_list %}
    {# User requested zoom via effect list, use defaults #}
    {% set final_z_val = d_z_val %}
{% endif %}

{# --- Rotate Logic --- #}
{% set final_r_val = 0 %}
{% set final_r_dur = d_r_dur %}

{% if rotate %}
    {# User provided explicit rotate param #}
    {% set r_str = rotate | as_str %}
    {% if "," in r_str %}
        {% set parts = r_str | split(pat=",") %}
        {% set final_r_val = parts[0] | trim %}
        {% set final_r_dur = parts[1] | trim %}
    {% else %}
        {% set final_r_val = r_str | trim %}
    {% endif %}
{% elif "rotate" in effect_list %}
    {# User requested rotate via effect list, use defaults #}
    {% set final_r_val = d_r_val %}
{% endif %}

{# Ensure durations have units if missing (simple check) #}
{% if not final_z_dur is ending_with("s") and not final_z_dur is ending_with("ms") %}
    {% set final_z_dur = final_z_dur ~ "s" %}
{% endif %}
{% if not final_r_dur is ending_with("s") and not final_r_dur is ending_with("ms") %}
    {% set final_r_dur = final_r_dur ~ "s" %}
{% endif %}

<a href="{{ icon_url }}" 
   class="social-icon-wrapper" 
   target="_blank" 
   rel="noopener noreferrer"
   style="--icon-size: {{ icon_size }}; --rotate-val: {{ final_r_val }}deg; --rotate-dur: {{ final_r_dur }}; --zoom-val: {{ final_z_val }}; --zoom-dur: {{ final_z_dur }};">
    <img src="/Social Icons Pack PNG/{{ folder }}/{{ icon_filename }}" 
         alt="{{ icon }}" 
         class="social-icon-img" />
</a>
