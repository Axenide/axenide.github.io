<div class="github-grid-container" style="{% if color %}--github-color: {{ color }};{% endif %}">
    {% set username = username | default(value="Axenide") %}
    
    {# Fetch data from the public API which supports simple GET requests #}
    {% set data = load_data(url="https://github-contributions-api.jogruber.de/v4/" ~ username, format="json") %}
    
    {% if data.contributions %}
        {# The API returns mixed order. We sort to get a continuous timeline 2020 -> 2026 -> Future. #}
        {% set all_days = data.contributions | sort(attribute="date") %}
        
        {# Find today's index to cut off future dates #}
        {% set today = now() | date(format="%Y-%m-%d") %}
        {% set end_index = all_days | length %}
        
        {# Zola/Tera limitations: we iterate to find the index #}
        {% for day in all_days %}
            {% if day.date == today %}
                {% set_global end_index = loop.index %}
            {% endif %}
        {% endfor %}
        
        {# Slice the last 365 days up to today #}
        {# We subtract 365 from end_index. #}
        {% set start_index = end_index - 365 %}
        {% if start_index < 0 %}{% set start_index = 0 %}{% endif %}
        
        {% set days = all_days | slice(start=start_index, end=end_index) %}
        
        {% set total_year = 0 %}
        
        {# Calculate total for the displayed period #}
        {% for day in days %}
             {% set_global total_year = total_year + day.count %}
        {% endfor %}

        {# Debug: Check date range #}
        <!-- Range: {{ days | first | get(key="date") }} to {{ days | last | get(key="date") }} -->
        
        <div class="github-stats">
            <strong>{{ total_year }}</strong> contributions in the last year
        </div>

        <div class="github-grid">
            {# Calculate offset for the first day to align correctly in the grid (Sunday start) #}
            {% set first_day = days | first %}
            {% set weekday = first_day.date | date(format="%w") | int %}
            
            {# Render empty cells for padding #}
            {% for i in range(end=weekday) %}
                <div class="github-day empty"></div>
            {% endfor %}

            {# Render actual days #}
            {% for day in days %}
                <div class="github-day level-{{ day.level }}" title="{{ day.date }}: {{ day.count }} contributions"></div>
            {% endfor %}
        </div>

        <div class="github-legend">
            <span>Less</span>
            <div class="github-day level-0"></div>
            <div class="github-day level-1"></div>
            <div class="github-day level-2"></div>
            <div class="github-day level-3"></div>
            <div class="github-day level-4"></div>
            <span>More</span>
        </div>
        
        <script>
            // Scroll to the end (most recent date) automatically
            document.addEventListener("DOMContentLoaded", function() {
                const grids = document.querySelectorAll('.github-grid');
                grids.forEach(grid => {
                    grid.scrollLeft = grid.scrollWidth;
                });
            });
        </script>
    {% else %}
         <div class="error" style="color: orange; border: 1px dashed orange; padding: 1rem;">
            <strong>Error:</strong> Could not load GitHub data.
        </div>
    {% endif %}
</div>
