{% set button_link = link | default(value=url | default(value="#")) %}
{% set effect_list = effect | default(value="") %}

{# --- Dimensions Logic --- #}
{% set wrapper_style = "" %}
{% set img_style = "" %}

{% if width and height %}
    {# Both provided: Fixed size #}
    {% set wrapper_style = "width: " ~ width ~ "; height: " ~ height ~ ";" %}
    {# Image keeps default 100% from class #}
{% elif width %}
    {# Only width provided: Maintain aspect ratio #}
    {% set wrapper_style = "width: " ~ width ~ "; height: auto;" %}
    {% set img_style = "height: auto;" %}
{% elif height %}
    {# Only height provided: Maintain aspect ratio #}
    {% set wrapper_style = "width: auto; height: " ~ height ~ ";" %}
    {% set img_style = "width: auto;" %}
{% else %}
    {# Neither provided: Default to 16px #}
    {% set wrapper_style = "width: 16px; height: 16px;" %}
{% endif %}

{# --- Effects (Zoom & Rotate) --- #}
{% set d_z_val = 1.2 %}
{% set d_z_dur = "0.25s" %}
{% set d_r_val = 30 %}
{% set d_r_dur = "0.5s" %}

{# Zoom #}
{% set final_z_val = 1.0 %}
{% set final_z_dur = d_z_dur %}
{% if zoom %}
    {% set z_str = zoom | as_str %}
    {% if "," in z_str %}
        {% set parts = z_str | split(pat=",") %}
        {% set final_z_val = parts[0] | trim %}
        {% set final_z_dur = parts[1] | trim %}
    {% else %}
        {% set final_z_val = z_str | trim %}
    {% endif %}
{% elif "zoom" in effect_list %}
    {% set final_z_val = d_z_val %}
{% endif %}

{# Rotate #}
{% set final_r_val = 0 %}
{% set final_r_dur = d_r_dur %}
{% if rotate %}
    {% set r_str = rotate | as_str %}
    {% if "," in r_str %}
        {% set parts = r_str | split(pat=",") %}
        {% set final_r_val = parts[0] | trim %}
        {% set final_r_dur = parts[1] | trim %}
    {% else %}
        {% set final_r_val = r_str | trim %}
    {% endif %}
{% elif "rotate" in effect_list %}
    {% set final_r_val = d_r_val %}
{% endif %}

{# Ensure units #}
{% if not final_z_dur is ending_with("s") and not final_z_dur is ending_with("ms") %}
    {% set final_z_dur = final_z_dur ~ "s" %}
{% endif %}
{% if not final_r_dur is ending_with("s") and not final_r_dur is ending_with("ms") %}
    {% set final_r_dur = final_r_dur ~ "s" %}
{% endif %}

<a href="{{ button_link }}" 
   class="social-icon-wrapper" 
   target="_blank" 
   rel="noopener noreferrer"
   style="{{ wrapper_style }} --rotate-val: {{ final_r_val }}deg; --rotate-dur: {{ final_r_dur }}; --zoom-val: {{ final_z_val }}; --zoom-dur: {{ final_z_dur }};">
    <img src="{{ image }}" 
         alt="button" 
         class="social-icon-img transparent"
         {% if img_style %}style="{{ img_style }}"{% endif %} />
</a>
