<span id="age">
	{%- set year = 31556926 -%}
	{%- set birth = 992304000 -%}
	{%- set now = now(utc=true) | date(format="%s") | int -%}
	{%- set age = (now - birth) / year -%}
	{%- set delay = 0 -%}

	{%- for ch in age | as_str | truncate(length=12, end="") | split(pat="") | slice(start=1, end=-1) -%}
		{%- if ch == "." -%}
			<span class="char dot">.</span>
		{%- else -%}
			{%- set digit = ch | int -%}
			<span class="char digit" style="--delay: {{ get_random(start=200, end=800) }}ms">
				<span class="true">{{ digit }}</span>
				{%- for offset in range(start=1, end=10) -%}
					{% set value = (digit + offset) % 10 %}
					<span aria-hidden="true">{{ value }}</span>
				{%- endfor -%}
				<span aria-hidden="true" class="true">{{ digit }}</span>
			</span>
			{%- set_global delay = delay + 1 -%}
		{%- endif -%}
	{%- endfor -%}
</span>

<script>
	(function() {
		const ageEl = document.getElementById('age');
		if (!ageEl) return;

		const birth = 992304000;
		const yearSeconds = 31556926;
		let isLocked = false;

		// Start counting immediately
		startLoop();

		ageEl.addEventListener('mouseenter', () => {
			// Lock updates to allow the CSS "slot machine" hover animation to play fully
			isLocked = true;
			
			// Clear inline styles so CSS rules (transition/transform) take priority
			const domChars = ageEl.querySelectorAll('.char.digit');
			domChars.forEach(el => {
				el.style.transition = '';
				el.style.transform = '';
			});

			// Unlock after animation finishes (max delay 800ms + transition 0.8s ~= 1.6s)
			setTimeout(() => {
				isLocked = false;
			}, 2000);
		});

		function startLoop() {
			setInterval(update, 50);
		}

		function update() {
			if (isLocked) return;

			const now = Date.now() / 1000;
			const age = (now - birth) / yearSeconds;
			const ageStr = age.toFixed(9); 
			
			const domChars = ageEl.querySelectorAll('.char');
			const chars = ageStr.split('');

			for (let i = 0; i < domChars.length && i < chars.length; i++) {
				const domEl = domChars[i];
				const char = chars[i];
				
				if (domEl.classList.contains('dot')) continue;
				updateDigit(domEl, char);
			}
		}

		function updateDigit(el, newChar) {
			const bottomSpan = el.lastElementChild;
			const topSpan = el.firstElementChild;
			const currentVal = bottomSpan.textContent;

			if (currentVal !== newChar) {
				// Prepare for spin: Set Top to current value so change is invisible at 0% transform
				topSpan.textContent = currentVal;
				// Set Bottom to new target value
				bottomSpan.textContent = newChar;

				// Reset to Top (instant)
				el.style.transition = 'none';
				el.style.transform = 'translateY(0)';
				
				// Force Reflow
				void el.offsetWidth;

				// Animate to Bottom (new value)
				el.style.transition = 'transform 0.1s ease-out';
				el.style.transform = 'translateY(calc(-100% + 1.5rem))';
			}
		}
	})();
</script>
